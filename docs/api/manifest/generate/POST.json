{"manifest":"# https://zipline.io/usage/manifest/#labels\nlabels:\n  app: zipline-ci-api\n  team: zipline-team\n  language: golang\n\n# https://zipline.io/usage/manifest/#versioning\nversion:\n  semver:\n    major: 0\n    minor: 0\n\n# https://zipline.io/usage/manifest/#build-stages\nstages:\n  build:\n    image: golang:1.11.2-alpine3.8\n    workDir: /go/src/${zipline_GIT_SOURCE}/${zipline_GIT_OWNER}/${zipline_GIT_NAME}\n    env:\n      CGO_ENABLED: 0\n      GOOS: linux\n    commands:\n    - go test `go list ./... | grep -v /vendor/`\n    - go build -a -installsuffix cgo -o ./publish/${zipline_LABEL_APP} .\n\n  # https://zipline.io/usage/extensions/zipline-extensions/#extensions-docker\n  bake:\n    image: extensions/docker:stable\n    action: build\n    repositories:\n    - zipline\n    path: ./publish\n    copy:\n    - /etc/ssl/certs/ca-certificates.crt\n\n  push-to-docker-hub:\n    image: extensions/docker:stable\n    action: push\n    repositories:\n    - zipline\n\n  # https://zipline.io/usage/extensions/zipline-extensions/#extensions-slack-build-status\n  slack-notify:\n    image: extensions/slack-build-status:stable\n    workspace: zipline\n    channels:\n    - '#build-${zipline_LABEL_TEAM}'\n    when:\n      status == 'succeeded' ||\n      status == 'failed'\n\n# https://zipline.io/usage/manifest/#releases\nreleases:\n  development:\n    stages:\n      deploy:\n        image: extensions/gke:stable\n        visibility: private\n        container:\n          port: 5000\n          env:\n            ENV1: value\n          cpu:\n            request: 100m\n            limit: 100m\n          memory:\n            request: 256Mi\n            limit: 256Mi\n        hosts:\n        - ci.development.zipline.io\n\n      slack-notify:\n        image: extensions/slack-build-status:stable\n        workspace: zipline\n        channels:\n        - '#build-${zipline_LABEL_TEAM}'\n        when:\n          status == 'succeeded' ||\n          status == 'failed'\n\n  staging:\n    stages:\n      # https://zipline.io/usage/extensions/zipline-extensions/#extensions-gke\n      deploy:\n        image: extensions/gke:stable\n        visibility: private\n        container:\n          port: 5000\n          env:\n            ENV1: value\n          cpu:\n            request: 100m\n            limit: 100m\n          memory:\n            request: 256Mi\n            limit: 256Mi\n        hosts:\n        - ci.staging.zipline.io\n\n      slack-notify:\n        image: extensions/slack-build-status:stable\n        workspace: zipline\n        channels:\n        - '#build-${zipline_LABEL_TEAM}'\n        when:\n          status == 'succeeded' ||\n          status == 'failed'\n\n  production:\n    # https://zipline.io/usage/manifest/#release-actions\n    actions:\n    - name: deploy-canary\n    - name: deploy-stable\n    - name: rollback-canary\n    stages:\n      deploy:\n        image: extensions/gke:stable\n        visibility: private\n        container:\n          port: 5000\n          env:\n            ENV1: value\n          cpu:\n            request: 100m\n            limit: 100m\n          memory:\n            request: 256Mi\n            limit: 256Mi\n        hosts:\n        - ci.zipline.io\n\n      slack-notify:\n        image: extensions/slack-build-status:stable\n        workspace: zipline\n        channels:\n        - '#build-${zipline_LABEL_TEAM}'\n        when:\n          status == 'succeeded' ||\n          status == 'failed'"}
